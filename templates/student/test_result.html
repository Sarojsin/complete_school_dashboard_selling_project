<!-- templates/student/test_result.html -->
{% extends 'base.html' %}

{% block title %}Test Result{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-md-3">
            <!-- Sidebar -->
            {% include 'student/sidebar.html' %}
        </div>
        <div class="col-md-9">
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('student_test_list') }}">Tests</a></li>
                    <li class="breadcrumb-item active">Test Result</li>
                </ol>
            </nav>

            <div class="card shadow-sm">
                <div class="card-header text-white text-center py-4" 
                     style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <h2 class="mb-2">Test Completed!</h2>
                    <h1 class="display-4 fw-bold">{{ score }}/{{ total_questions }}</h1>
                    <p class="mb-0">{{ percentage }}% â€¢ {{ result_status }}</p>
                </div>
                
                <div class="card-body">
                    <!-- Performance Summary -->
                    <div class="row text-center mb-4">
                        <div class="col-md-3">
                            <div class="border rounded p-3">
                                <h5 class="text-primary">{{ correct_answers }}</h5>
                                <p class="mb-0 text-muted">Correct</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded p-3">
                                <h5 class="text-danger">{{ wrong_answers }}</h5>
                                <p class="mb-0 text-muted">Wrong</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded p-3">
                                <h5 class="text-warning">{{ skipped_questions }}</h5>
                                <p class="mb-0 text-muted">Skipped</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded p-3">
                                <h5 class="text-info">{{ time_taken }}</h5>
                                <p class="mb-0 text-muted">Time Taken</p>
                            </div>
                        </div>
                    </div>

                    <!-- Score Visualization -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5>Score Distribution</h5>
                            <div class="progress mb-2" style="height: 30px;">
                                <div class="progress-bar bg-success" style="width: {{ percentage }}%">
                                    {{ percentage }}%
                                </div>
                            </div>
                            <div class="d-flex justify-content-between text-muted">
                                <small>0%</small>
                                <small>Passing: 40%</small>
                                <small>100%</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h5>Performance Rating</h5>
                            <div class="text-center">
                                <div class="display-6 text-{{ 'success' if percentage >= 80 else 'warning' if percentage >= 60 else 'danger' }}">
                                    {{ performance_rating }}
                                </div>
                                <p class="text-muted">{{ performance_feedback }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Question Review -->
                    <h5 class="mb-3">Question Review</h5>
                    <div class="accordion" id="questionReview">
                        {% for question in questions %}
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button {% if not loop.first %}collapsed{% endif %}" 
                                        type="button" data-bs-toggle="collapse" 
                                        data-bs-target="#question{{ loop.index }}">
                                    <div class="d-flex align-items-center w-100">
                                        <span class="me-3">Q{{ loop.index }}</span>
                                        <span class="flex-grow-1">{{ question.question_text|truncate(50) }}</span>
                                        <span class="badge bg-{% if question.is_correct %}success{% else %}danger{% endif %}">
                                            {% if question.is_correct %}Correct{% else %}Incorrect{% endif %}
                                        </span>
                                    </div>
                                </button>
                            </h2>
                            <div id="question{{ loop.index }}" 
                                 class="accordion-collapse collapse {% if loop.first %}show{% endif %}" 
                                 data-bs-parent="#questionReview">
                                <div class="accordion-body">
                                    <p><strong>Question:</strong> {{ question.question_text }}</p>
                                    
                                    <div class="mb-2">
                                        <strong>Your Answer:</strong>
                                        <span class="{% if question.is_correct %}text-success{% else %}text-danger{% endif %}">
                                            {{ question.user_answer }}
                                        </span>
                                    </div>
                                    
                                    {% if not question.is_correct %}
                                    <div class="mb-2">
                                        <strong>Correct Answer:</strong>
                                        <span class="text-success">{{ question.correct_answer }}</span>
                                    </div>
                                    {% endif %}
                                    
                                    {% if question.explanation %}
                                    <div class="alert alert-info mt-2">
                                        <strong>Explanation:</strong> {{ question.explanation }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- Actions -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="{{ url_for('student_test_list') }}" class="btn btn-outline-primary">
                            <i class="fas fa-arrow-left me-2"></i> Back to Tests
                        </a>
                        <div>
                            <button class="btn btn-outline-success me-2">
                                <i class="fas fa-download me-2"></i> Download Result
                            </button>
                            <button class="btn btn-primary" onclick="window.print()">
                                <i class="fas fa-print me-2"></i> Print Result
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Improvement Suggestions -->
            <div class="card shadow-sm mt-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Improvement Suggestions</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        {% for suggestion in improvement_suggestions %}
                        <li class="list-group-item">
                            <i class="fas fa-lightbulb text-warning me-2"></i>
                            {{ suggestion }}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}