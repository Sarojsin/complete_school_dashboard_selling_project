<!-- templates/teacher/student_detail.html -->
{% extends 'base.html' %}

{% block title %}Student Details - {{ student.name }}{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Student Details</h2>
        <a href="{{ url_for('teacher_students') }}" class="btn btn-outline-primary">
            <i class="fas fa-arrow-left me-2"></i> Back to Students
        </a>
    </div>

    <div class="row">
        <!-- Student Information -->
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body text-center">
                    <img src="{{ student.profile_pic or '/static/images/default-avatar.png' }}"
                        class="rounded-circle mb-3" width="120" height="120" alt="Profile Picture">
                    <h4>{{ student.name }}</h4>
                    <p class="text-muted">Student ID: {{ student.id }}</p>
                    <p class="text-muted">{{ student.grade }} â€¢ {{ student.section }}</p>

                    <div class="d-grid gap-2 mt-3">
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#contactModal">
                            <i class="fas fa-envelope me-2"></i> Contact Student
                        </button>
                        <button class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#parentModal">
                            <i class="fas fa-users me-2"></i> Parent Info
                        </button>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="card shadow-sm mt-4">
                <div class="card-header bg-light">
                    <h6 class="mb-0">Quick Stats</h6>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Attendance</span>
                        <span class="fw-bold">{{ student.attendance_percentage }}%</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Average Grade</span>
                        <span class="fw-bold">{{ student.average_grade }}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Assignments</span>
                        <span class="fw-bold">{{ student.completed_assignments }}/{{ student.total_assignments }}</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>Behavior</span>
                        <span
                            class="badge bg-{{ 'success' if student.behavior == 'good' else 'warning' if student.behavior == 'average' else 'danger' }}">
                            {{ student.behavior|title }}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Information -->
        <div class="col-md-8">
            <!-- Navigation Tabs -->
            <ul class="nav nav-tabs" id="studentTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="academic-tab" data-bs-toggle="tab" data-bs-target="#academic"
                        type="button">Academic</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="attendance-tab" data-bs-toggle="tab" data-bs-target="#attendance"
                        type="button">Attendance</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="assignments-tab" data-bs-toggle="tab" data-bs-target="#assignments"
                        type="button">Assignments</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="behavior-tab" data-bs-toggle="tab" data-bs-target="#behavior"
                        type="button">Behavior</button>
                </li>
            </ul>

            <div class="tab-content p-3 border border-top-0 rounded-bottom" id="studentTabsContent">
                <!-- Academic Tab -->
                <div class="tab-pane fade show active" id="academic" role="tabpanel">
                    <h5 class="mb-3">Academic Performance</h5>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Subject</th>
                                    <th>Current Grade</th>
                                    <th>Last Test</th>
                                    <th>Progress</th>
                                    <th>Teacher</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for subject in student.subjects %}
                                <tr>
                                    <td>{{ subject.name }}</td>
                                    <td>
                                        <span
                                            class="badge bg-{{ 'success' if subject.grade >= 90 else 'warning' if subject.grade >= 70 else 'danger' }}">
                                            {{ subject.grade }}%
                                        </span>
                                    </td>
                                    <td>{{ subject.last_test_score }}/{{ subject.last_test_total }}</td>
                                    <td>
                                        <div class="progress" style="height: 8px;">
                                            <div class="progress-bar bg-{{ 'success' if subject.trend == 'up' else 'danger' }}"
                                                style="width: {{ subject.progress }}%"></div>
                                        </div>
                                    </td>
                                    <td>{{ subject.teacher }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Attendance Tab -->
                <div class="tab-pane fade" id="attendance" role="tabpanel">
                    <h5 class="mb-3">Attendance Record</h5>
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card bg-primary text-white text-center">
                                <div class="card-body py-2">
                                    <h6>{{ student.attendance_stats.present }}</h6>
                                    <small>Present</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-danger text-white text-center">
                                <div class="card-body py-2">
                                    <h6>{{ student.attendance_stats.absent }}</h6>
                                    <small>Absent</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-warning text-dark text-center">
                                <div class="card-body py-2">
                                    <h6>{{ student.attendance_stats.late }}</h6>
                                    <small>Late</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-info text-white text-center">
                                <div class="card-body py-2">
                                    <h6>{{ student.attendance_percentage }}%</h6>
                                    <small>Overall</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Subject</th>
                                    <th>Remarks</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for record in student.attendance_records %}
                                <tr>
                                    <td>{{ record.date }}</td>
                                    <td>
                                        <span
                                            class="badge bg-{{ 'success' if record.status == 'present' else 'danger' if record.status == 'absent' else 'warning' }}">
                                            {{ record.status|title }}
                                        </span>
                                    </td>
                                    <td>{{ record.subject }}</td>
                                    <td>{{ record.remarks or '-' }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Assignments Tab -->
                <div class="tab-pane fade" id="assignments" role="tabpanel">
                    <h5 class="mb-3">Assignment History</h5>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Assignment</th>
                                    <th>Subject</th>
                                    <th>Due Date</th>
                                    <th>Submitted</th>
                                    <th>Grade</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for assignment in student.assignments %}
                                <tr>
                                    <td>{{ assignment.title }}</td>
                                    <td>{{ assignment.subject }}</td>
                                    <td>{{ assignment.due_date }}</td>
                                    <td>{{ assignment.submitted_date or 'Not submitted' }}</td>
                                    <td>
                                        {% if assignment.grade %}
                                        <span
                                            class="badge bg-{{ 'success' if assignment.grade >= 80 else 'warning' if assignment.grade >= 60 else 'danger' }}">
                                            {{ assignment.grade }}%
                                        </span>
                                        {% else %}
                                        <span class="badge bg-secondary">Not graded</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span
                                            class="badge bg-{{ 'success' if assignment.status == 'submitted' else 'warning' if assignment.status == 'pending' else 'danger' }}">
                                            {{ assignment.status|title }}
                                        </span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Behavior Tab -->
                <div class="tab-pane fade" id="behavior" role="tabpanel">
                    <h5 class="mb-3">Behavior & Conduct</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0">Conduct Record</h6>
                                </div>
                                <div class="card-body">
                                    {% for record in student.behavior_records %}
                                    <div class="border-bottom pb-2 mb-2">
                                        <div class="d-flex justify-content-between">
                                            <strong>{{ record.date }}</strong>
                                            <span class="badge bg-{{ record.type_color }}">{{ record.type }}</span>
                                        </div>
                                        <p class="mb-0 small">{{ record.description }}</p>
                                        <small class="text-muted">By: {{ record.teacher }}</small>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0">Recent Feedback</h6>
                                </div>
                                <div class="card-body">
                                    {% for feedback in student.feedback %}
                                    <div class="border-bottom pb-2 mb-2">
                                        <div class="d-flex justify-content-between">
                                            <strong>{{ feedback.date }}</strong>
                                            <small class="text-muted">{{ feedback.subject }}</small>
                                        </div>
                                        <p class="mb-0 small">{{ feedback.comments }}</p>
                                        <small class="text-muted">- {{ feedback.teacher }}</small>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Contact Modal -->
<div class="modal fade" id="contactModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Contact {{ student.name }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form method="POST" action="{{ url_for('teacher_contact_student', student_id=student.id) }}">
                    <div class="mb-3">
                        <label class="form-label">Subject</label>
                        <input type="text" class="form-control" name="subject" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Message</label>
                        <textarea class="form-control" name="message" rows="4" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Priority</label>
                        <select class="form-select" name="priority">
                            <option value="low">Low</option>
                            <option value="normal" selected>Normal</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Send Message</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Parent Info Modal -->
<div class="modal fade" id="parentModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Parent Information</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                {% if student.parents %}
                {% for parent in student.parents %}
                <div class="border-bottom pb-3 mb-3">
                    <h6>{{ parent.relationship|title }}: {{ parent.name }}</h6>
                    <p class="mb-1"><strong>Email:</strong> {{ parent.email }}</p>
                    <p class="mb-1"><strong>Phone:</strong> {{ parent.phone }}</p>
                    <p class="mb-0"><strong>Occupation:</strong> {{ parent.occupation or 'Not specified' }}</p>
                </div>
                {% endfor %}
                {% else %}
                <p class="text-muted">No parent information available.</p>
                {% endif %}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}