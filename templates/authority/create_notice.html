<!-- templates/teacher/create_notice.html -->
{% extends 'base.html' %}

{% block title %}Create Notice{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('teacher.dashboard') }}">Dashboard</a></li>
                    <li class="breadcrumb-item active">Create Notice</li>
                </ol>
            </nav>

            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">Create New Notice</h4>
                </div>
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label class="form-label">Notice Title *</label>
                                    <input type="text" class="form-control" name="title" 
                                           placeholder="Enter notice title" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Priority</label>
                                    <select class="form-select" name="priority">
                                        <option value="low">Low</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="high">High</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Notice Content *</label>
                            <textarea class="form-control" id="noticeContent" name="content" 
                                      rows="10" placeholder="Write your notice content here..." required></textarea>
                            <div class="form-text">You can use basic HTML formatting if needed.</div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Target Audience *</label>
                                    <select class="form-select" name="audience" required>
                                        <option value="all">All Students</option>
                                        <option value="specific_class">Specific Class</option>
                                        <option value="specific_grade">Specific Grade</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3" id="classSelection" style="display: none;">
                                    <label class="form-label">Select Class</label>
                                    <select class="form-select" name="specific_class">
                                        <option value="">Select Class</option>
                                        {% for class in classes %}
                                        <option value="{{ class.id }}">{{ class.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="mb-3" id="gradeSelection" style="display: none;">
                                    <label class="form-label">Select Grade</label>
                                    <select class="form-select" name="specific_grade">
                                        <option value="">Select Grade</option>
                                        {% for grade in grades %}
                                        <option value="{{ grade }}">{{ grade }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Publish Date *</label>
                                    <input type="datetime-local" class="form-control" name="publish_date" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Expiry Date</label>
                                    <input type="datetime-local" class="form-control" name="expiry_date">
                                    <div class="form-text">Leave empty if notice should not expire</div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Attachments</label>
                            <input type="file" class="form-control" name="attachments" multiple>
                            <div class="form-text">You can attach multiple files (PDF, Word, Images). Max 10MB per file.</div>
                        </div>

                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="is_important" id="is_important">
                                <label class="form-check-label" for="is_important">
                                    Mark as Important Notice
                                </label>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="send_notification" id="send_notification" checked>
                                <label class="form-check-label" for="send_notification">
                                    Send email notification to students/parents
                                </label>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="d-flex justify-content-between">
                                    <a href="{{ url_for('teacher.dashboard') }}" class="btn btn-secondary">
                                        <i class="fas fa-arrow-left me-2"></i> Cancel
                                    </a>
                                    <div>
                                        <button type="submit" name="action" value="draft" class="btn btn-outline-primary me-2">
                                            <i class="fas fa-save me-2"></i> Save as Draft
                                        </button>
                                        <button type="submit" name="action" value="publish" class="btn btn-primary">
                                            <i class="fas fa-paper-plane me-2"></i> Publish Notice
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Preview Section -->
            <div class="card shadow-sm mt-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Notice Preview</h5>
                </div>
                <div class="card-body">
                    <div id="noticePreview" class="border rounded p-3 bg-light">
                        <p class="text-muted text-center">Preview will appear here as you type...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Audience selection
    const audienceSelect = document.querySelector('select[name="audience"]');
    const classSelection = document.getElementById('classSelection');
    const gradeSelection = document.getElementById('gradeSelection');

    audienceSelect.addEventListener('change', function() {
        classSelection.style.display = 'none';
        gradeSelection.style.display = 'none';

        if (this.value === 'specific_class') {
            classSelection.style.display = 'block';
        } else if (this.value === 'specific_grade') {
            gradeSelection.style.display = 'block';
        }
    });

    // Notice preview
    const contentTextarea = document.getElementById('noticeContent');
    const previewDiv = document.getElementById('noticePreview');

    contentTextarea.addEventListener('input', function() {
        previewDiv.innerHTML = this.value || '<p class="text-muted text-center">Preview will appear here as you type...</p>';
    });

    // Set default publish date to current datetime
    const now = new Date();
    const publishDateInput = document.querySelector('input[name="publish_date"]');
    publishDateInput.value = now.toISOString().slice(0, 16);

    // Set default expiry date to 7 days from now
    const expiryDate = new Date(now);
    expiryDate.setDate(expiryDate.getDate() + 7);
    const expiryDateInput = document.querySelector('input[name="expiry_date"]');
    expiryDateInput.value = expiryDate.toISOString().slice(0, 16);
});
</script>
{% endblock %}